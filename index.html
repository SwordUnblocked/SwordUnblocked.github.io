<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'none'; 
        script-src 'self' https://apis.google.com;
        style-src 'self' 'unsafe-inline'; 
        img-src 'self'; 
        connect-src 'self'; 
        font-src 'self';">
    <title>Skibidi Dop Dop Dop yes yes</title>
</head>
<body>
    <div id="content" style="display:none;">
        <h1>Welcome, authenticated user!</h1>
    </div>
    <div id="signin-button">Sign In</div>

    <script src="https://apis.google.com/js/platform.js?onload=initGoogleAPI" async defer></script>
    <script>
        let clientId = '692476350843-4jcjp4s3emmjs4s4o058jime0dfo9c8a.apps.googleusercontent.com';

        let authorizedHashes = [
            '-1718874134',
            'simple_hash_of_email_2'
            // Command: node -e "const simpleHash = str => { let hash = 0; for (let i = 0; i < str.length; i++) { hash = (hash << 5) - hash + str.charCodeAt(i); hash &= hash; } return hash.toString(); }; console.log(simpleHash('user@example.com'));"
        ];

        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = (hash << 5) - hash + str.charCodeAt(i);
                hash = hash & hash; // Convert to 32-bit integer
            }
            return hash.toString();
        }

        function onSignIn(googleUser) {
            var profile = googleUser.getBasicProfile();
            let email = profile.getEmail();
            let emailHash = simpleHash(email);

            if (authorizedHashes.includes(emailHash)) {
                document.getElementById('content').style.display = 'block';
            } else {
                document.getElementById('content').style.display = 'none';
            }

            document.getElementById('signin-button').style.display = 'none';
        }

        function onFailure(error) {
            console.error('Sign-in failed:', error);
        }

        function renderButton() {
            gapi.signin2.render('signin-button', {
                'scope': 'profile email',
                'width': 240,
                'height': 50,
                'longtitle': true,
                'theme': 'dark',
                'onsuccess': onSignIn,
                'onfailure': onFailure
            });
        }

        function initGoogleAPI() {
            gapi.load('auth2', function() {
                gapi.auth2.init({
                    client_id: clientId
                }).then(renderButton);
            });
        }

        document.getElementById('signin-button').addEventListener('click', function() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signIn().then(function (googleUser) {
                onSignIn(googleUser);
            }, function (error) {
                onFailure(error);
            });
        });
    </script>
</body>
</html>
